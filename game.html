<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Quest Game - AstroLearn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        .game-container {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 400px;
            background: linear-gradient(to bottom, #0B0F2F 0%, #1a1f3f 50%, #0B0F2F 100%);
            border-radius: 20px;
            overflow: hidden;
            border: 2px solid #482880;
        }
        
        .planet {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            transition: all 0.5s ease;
            filter: drop-shadow(0 0 10px currentColor);
        }
        
        .planet.reached {
            animation: planetGlow 1s infinite alternate;
        }
        
        @keyframes planetGlow {
            from { filter: drop-shadow(0 0 10px currentColor); }
            to { filter: drop-shadow(0 0 20px currentColor); }
        }
        
        .spaceship {
            position: absolute;
            font-size: 50px;
            transition: all 0.8s ease;
            z-index: 10;
            filter: drop-shadow(0 0 15px #4FC3F7);
        }
        
        .asteroid {
            position: absolute;
            font-size: 60px;
            animation: asteroidFall 1s ease-in forwards;
            z-index: 5;
        }
        
        @keyframes asteroidFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(500px) rotate(360deg);
                opacity: 0;
            }
        }
        
        .blackhole {
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, #000 0%, #482880 50%, #000 100%);
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) scale(0);
            animation: blackholeExpand 2s ease-out forwards;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
        }
        
        @keyframes blackholeExpand {
            0% {
                transform: translate(-50%, -50%) scale(0);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.5);
            }
            100% {
                transform: translate(-50%, -50%) scale(3);
            }
        }
        
        .explosion {
            position: absolute;
            font-size: 80px;
            animation: explode 0.5s ease-out forwards;
            z-index: 15;
        }
        
        @keyframes explode {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-[#0B0F2F] via-[#482880] to-[#0B0F2F] min-h-screen text-[#F5F7FA] overflow-x-hidden">
    <!-- Floating Stars Background -->
    <div id="floatingStars"></div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <img src="sticker.webp" alt="AstroLearn Logo" class="h-12 w-12 object-contain">
                <h1 class="text-2xl font-bold bg-gradient-to-r from-[#4FC3F7] to-[#FF6EC7] bg-clip-text text-transparent">
                    AstroLearn
                </h1>
            </div>
            <div class="hidden md:flex space-x-6 items-center">
                <a href="index.html" class="nav-link">Home</a>
                <a href="dashboard.html" class="nav-link protected-link">Dashboard</a>
                <a href="schedule.html" class="nav-link protected-link">Schedule</a>
                <a href="resources.html" class="nav-link protected-link">Resources</a>
                <a href="game.html" class="nav-link active protected-link">Games</a>
                <a href="login.html" class="btn-secondary py-2 px-4 text-sm" id="authBtn">Sign In</a>
            </div>
            <button class="md:hidden text-2xl" id="mobileMenuBtn">‚ò∞</button>
        </div>
        <div class="md:hidden hidden" id="mobileMenu">
            <div class="flex flex-col space-y-2 p-4">
                <a href="index.html" class="nav-link">Home</a>
                <a href="dashboard.html" class="nav-link protected-link">Dashboard</a>
                <a href="schedule.html" class="nav-link protected-link">Schedule</a>
                <a href="resources.html" class="nav-link protected-link">Resources</a>
                <a href="game.html" class="nav-link protected-link">Games</a>
                <a href="login.html" class="btn-secondary py-2 px-4 text-center" id="authBtnMobile">Sign In</a>
            </div>
        </div>
    </nav>

    <!-- Game Header -->
    <section class="container mx-auto px-6 py-12">
        <div class="text-center mb-8">
            <div class="text-6xl mb-4">üöÄ</div>
            <h1 class="text-5xl md:text-7xl font-bold mb-4">
                <span class="bg-gradient-to-r from-[#4FC3F7] to-[#FF6EC7] bg-clip-text text-transparent">
                    Space Quest
                </span>
            </h1>
            <p class="text-xl text-[#F5F7FA]/80">Answer questions correctly to travel through planets. Get one wrong and an asteroid will send you back!</p>
        </div>

        <!-- Game Stats -->
        <div class="grid md:grid-cols-3 gap-6 mb-8">
            <div class="glass-card p-6 text-center">
                <div class="text-3xl mb-2">üåç</div>
                <h3 class="text-lg font-bold mb-2">Current Level</h3>
                <p class="text-2xl font-bold text-[#4FC3F7]" id="currentLevel">1</p>
            </div>
            <div class="glass-card p-6 text-center">
                <div class="text-3xl mb-2">ü™ê</div>
                <h3 class="text-lg font-bold mb-2">Planets Reached</h3>
                <p class="text-2xl font-bold text-[#FF6EC7]" id="planetsReached">0</p>
            </div>
            <div class="glass-card p-6 text-center">
                <div class="text-3xl mb-2">‚≠ê</div>
                <h3 class="text-lg font-bold mb-2">Game XP</h3>
                <p class="text-2xl font-bold text-[#4FC3F7]" id="gameXP">0</p>
            </div>
        </div>

        <!-- Game and Question Area - Side by Side -->
        <div class="grid md:grid-cols-2 gap-6 mb-8">
            <!-- Game Area - Left Side -->
            <div class="glass-card p-4 md:p-6">
                <h3 class="text-xl font-bold mb-4 text-center">
                    <span class="bg-gradient-to-r from-[#4FC3F7] to-[#FF6EC7] bg-clip-text text-transparent">
                        Your Journey
                    </span>
                </h3>
                <div class="game-container" id="gameContainer" style="height: 400px;">
                    <!-- Spaceship, planets, and game elements will be rendered here -->
                </div>
            </div>

            <!-- Question Area - Right Side -->
            <div id="questionArea" class="glass-card p-4 md:p-6 hidden">
                <h2 class="text-2xl font-bold mb-4 text-center">
                    <span class="bg-gradient-to-r from-[#4FC3F7] to-[#FF6EC7] bg-clip-text text-transparent">
                        Question <span id="questionNumber">1</span>
                    </span>
                </h2>
                <div class="mb-4">
                    <p class="text-lg md:text-xl text-center mb-4" id="questionText">Loading question...</p>
                    <div class="grid grid-cols-1 gap-3" id="optionsContainer">
                        <!-- Options will be populated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Level Complete Modal -->
        <div id="levelCompleteModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
            <div class="fixed inset-0 bg-black/70 backdrop-blur-sm"></div>
            <div class="relative glass-card p-8 max-w-md w-full z-10 text-center">
                <div class="text-6xl mb-4">üåå</div>
                <h2 class="text-3xl font-bold mb-4">Level Complete!</h2>
                <p class="text-lg mb-6">You've entered the black hole and reached the next level!</p>
                <div class="flex gap-4 justify-center">
                    <button class="btn-primary" id="nextLevelBtn">Continue to Next Level</button>
                    <button class="btn-secondary" id="restartGameBtn">Restart Game</button>
                </div>
            </div>
        </div>

        <!-- Game Over Modal -->
        <div id="gameOverModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
            <div class="fixed inset-0 bg-black/70 backdrop-blur-sm"></div>
            <div class="relative glass-card p-8 max-w-md w-full z-10 text-center">
                <div class="text-6xl mb-4">üí•</div>
                <h2 class="text-3xl font-bold mb-4">Asteroid Hit!</h2>
                <p class="text-lg mb-6">You got hit by an asteroid! The answer was incorrect.</p>
                <div class="flex gap-4 justify-center">
                    <button class="btn-primary" id="restartAfterAsteroidBtn">Try Again</button>
                    <button class="btn-secondary" onclick="location.reload()">Back to Menu</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container mx-auto px-6 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0 flex items-center gap-2">
                    <img src="sticker.webp" alt="AstroLearn Logo" class="w-6 h-6">
                    <p class="text-sm text-[#F5F7FA]/70">Powered by AstroLearn</p>
                </div>
                <div class="flex space-x-6">
                    <a href="about.html" class="footer-link">About</a>
                    <a href="contact.html" class="footer-link">Contact</a>
                    <a href="privacy.html" class="footer-link">Privacy</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Check authentication
        document.addEventListener('DOMContentLoaded', () => {
            if (!checkAuth()) {
                return;
            }
            updateNavigation();
            initFloatingStars();
            initGame();
        });

        // Game state
        let currentLevel = 1;
        let currentPlanet = 0;
        let currentQuestion = 0;
        let planetsReached = 0;
        let gameXP = 0;
        let questions = [];
        let userAnswers = [];
        const QUESTIONS_PER_LEVEL = 10; // Increased from 5 to 10 planets

        // Get grade level from preferences
        function getGradeLevel() {
            const prefs = localStorage.getItem('astrolearn_preferences');
            if (prefs) {
                try {
                    const preferences = JSON.parse(prefs);
                    return preferences.grade || 9;
                } catch (e) {
                    console.error('Error parsing preferences:', e);
                }
            }
            return 9;
        }

        // Get selected subjects
        function getSelectedSubjects() {
            const prefs = localStorage.getItem('astrolearn_preferences');
            if (prefs) {
                try {
                    const preferences = JSON.parse(prefs);
                    if (preferences.subjects && Array.isArray(preferences.subjects) && preferences.subjects.length > 0) {
                        return preferences.subjects;
                    }
                } catch (e) {
                    console.error('Error parsing preferences:', e);
                }
            }
            return ['math', 'science', 'reading', 'language'];
        }

        // Quiz questions by grade and subject (from quizzes.html)
        const quizQuestionsByGrade = {
            6: {
                math: {
                    "Introduction to Fractions": [
                        { question: "What is 1/2 + 1/4?", options: ["2/4", "3/4", "1/6", "2/6"], correct: 1 },
                        { question: "Which fraction is larger: 1/3 or 1/4?", options: ["1/3", "1/4", "They're equal", "Cannot determine"], correct: 0 },
                        { question: "What is the decimal form of 3/4?", options: ["0.25", "0.5", "0.75", "1.0"], correct: 2 },
                        { question: "What is 2/3 of 12?", options: ["6", "8", "9", "10"], correct: 1 },
                        { question: "Which is equivalent to 1/2?", options: ["2/4", "3/6", "4/8", "All of the above"], correct: 3 }
                    ],
                    "Decimal Operations": [
                        { question: "What is 2.5 + 3.7?", options: ["5.2", "6.2", "5.12", "6.12"], correct: 1 },
                        { question: "What is 5.8 - 2.3?", options: ["3.5", "3.3", "2.5", "2.3"], correct: 0 },
                        { question: "What is 0.5 √ó 4?", options: ["2.0", "2.5", "1.5", "0.2"], correct: 0 },
                        { question: "What is 6.4 √∑ 2?", options: ["3.2", "3.4", "2.2", "2.4"], correct: 0 },
                        { question: "Round 3.789 to the nearest tenth", options: ["3.7", "3.8", "3.79", "4.0"], correct: 1 }
                    ],
                    "Basic Geometry Shapes": [
                        { question: "How many sides does a triangle have?", options: ["2", "3", "4", "5"], correct: 1 },
                        { question: "What is the area of a rectangle with length 5 and width 3?", options: ["8", "15", "16", "20"], correct: 1 },
                        { question: "What is the perimeter of a square with side length 4?", options: ["8", "12", "16", "20"], correct: 2 },
                        { question: "How many degrees are in a right angle?", options: ["45", "90", "180", "360"], correct: 1 },
                        { question: "What shape has 4 equal sides?", options: ["Rectangle", "Square", "Rhombus", "All of the above"], correct: 3 }
                    ],
                    "Ratios and Proportions": [
                        { question: "If 2:3 = 4:x, what is x?", options: ["5", "6", "7", "8"], correct: 1 },
                        { question: "What is the ratio of 8 to 12 in simplest form?", options: ["2:3", "4:6", "8:12", "1:2"], correct: 0 },
                        { question: "If 3 apples cost $6, how much do 5 apples cost?", options: ["$8", "$10", "$12", "$15"], correct: 1 },
                        { question: "What percentage is 3/4?", options: ["30%", "50%", "75%", "100%"], correct: 2 },
                        { question: "If a recipe calls for 2 cups flour and 1 cup sugar, what is the ratio?", options: ["1:2", "2:1", "2:3", "3:2"], correct: 1 }
                    ],
                    "Number Operations": [
                        { question: "What is 15 √ó 4?", options: ["50", "60", "70", "80"], correct: 1 },
                        { question: "What is 144 √∑ 12?", options: ["10", "11", "12", "13"], correct: 2 },
                        { question: "What is the prime factorization of 12?", options: ["2√ó2√ó3", "3√ó4", "2√ó6", "1√ó12"], correct: 0 },
                        { question: "What is the LCM of 4 and 6?", options: ["12", "18", "24", "30"], correct: 0 },
                        { question: "What is the GCF of 12 and 18?", options: ["3", "6", "9", "12"], correct: 1 }
                    ],
                    "Measurement and Data": [
                        { question: "How many centimeters are in a meter?", options: ["10", "100", "1000", "10000"], correct: 1 },
                        { question: "What is the volume of a cube with side length 3?", options: ["9", "18", "27", "36"], correct: 2 },
                        { question: "How many milliliters are in a liter?", options: ["10", "100", "1000", "10000"], correct: 2 },
                        { question: "What is the mean of 4, 6, 8, 10?", options: ["6", "7", "8", "9"], correct: 1 },
                        { question: "What is the median of 3, 5, 7, 9, 11?", options: ["5", "7", "9", "11"], correct: 1 }
                    ]
                },
                science: {
                    "Introduction to Matter": [
                        { question: "What are the three states of matter?", options: ["Solid, Liquid, Gas", "Hot, Cold, Warm", "Big, Medium, Small", "Hard, Soft, Medium"], correct: 0 },
                        { question: "What happens when water freezes?", options: ["It becomes a gas", "It becomes a solid", "It disappears", "It becomes a liquid"], correct: 1 },
                        { question: "What is matter made of?", options: ["Energy", "Atoms", "Light", "Sound"], correct: 1 },
                        { question: "What is the process called when a solid turns into a liquid?", options: ["Freezing", "Melting", "Evaporation", "Condensation"], correct: 1 },
                        { question: "Which state of matter has a definite shape?", options: ["Solid", "Liquid", "Gas", "Plasma"], correct: 0 }
                    ],
                    "Earth Science Basics": [
                        { question: "What is the outermost layer of Earth?", options: ["Core", "Mantle", "Crust", "Atmosphere"], correct: 2 },
                        { question: "What causes day and night?", options: ["Earth's rotation", "Earth's revolution", "The moon", "The sun"], correct: 0 },
                        { question: "What is the water cycle?", options: ["Movement of water on Earth", "Creation of water", "Destruction of water", "Storage of water"], correct: 0 },
                        { question: "What are the four seasons?", options: ["Spring, Summer, Fall, Winter", "Hot, Cold, Warm, Cool", "Day, Night, Dawn, Dusk", "North, South, East, West"], correct: 0 },
                        { question: "What is a renewable resource?", options: ["A resource that can be replaced", "A resource that cannot be replaced", "A resource that is expensive", "A resource that is rare"], correct: 0 }
                    ],
                    "Plant Life": [
                        { question: "What do plants need to make food?", options: ["Water, sunlight, carbon dioxide", "Soil, air, water", "Sunlight, oxygen, water", "Carbon dioxide, oxygen, soil"], correct: 0 },
                        { question: "What is photosynthesis?", options: ["The process plants use to make food", "The process plants use to breathe", "The process plants use to grow", "The process plants use to reproduce"], correct: 0 },
                        { question: "What part of the plant absorbs water?", options: ["Leaves", "Stem", "Roots", "Flowers"], correct: 2 },
                        { question: "What gas do plants release during photosynthesis?", options: ["Carbon dioxide", "Oxygen", "Nitrogen", "Hydrogen"], correct: 1 },
                        { question: "What is the main function of leaves?", options: ["To absorb water", "To make food", "To support the plant", "To produce seeds"], correct: 1 }
                    ],
                    "Animal Life": [
                        { question: "What do animals need to survive?", options: ["Food, water, shelter, air", "Food, water, toys, games", "Water, shelter, clothes, money", "Food, water, friends, family"], correct: 0 },
                        { question: "What is a habitat?", options: ["An animal's home", "An animal's food", "An animal's friend", "An animal's enemy"], correct: 0 },
                        { question: "What is an adaptation?", options: ["A trait that helps an animal survive", "A trait that harms an animal", "A trait that does nothing", "A trait that is invisible"], correct: 0 },
                        { question: "What is a food chain?", options: ["How energy moves through an ecosystem", "How animals move", "How plants grow", "How water flows"], correct: 0 },
                        { question: "What is a predator?", options: ["An animal that hunts other animals", "An animal that is hunted", "An animal that eats plants", "An animal that lives in water"], correct: 0 }
                    ],
                    "Weather and Climate": [
                        { question: "What is weather?", options: ["The condition of the atmosphere at a specific time", "The condition of the ocean", "The condition of the ground", "The condition of space"], correct: 0 },
                        { question: "What is climate?", options: ["The average weather over a long time", "The weather today", "The weather tomorrow", "The weather next week"], correct: 0 },
                        { question: "What causes wind?", options: ["Differences in air pressure", "Differences in temperature", "Differences in humidity", "All of the above"], correct: 3 },
                        { question: "What is precipitation?", options: ["Water that falls from the sky", "Water that rises to the sky", "Water that stays on the ground", "Water that evaporates"], correct: 0 },
                        { question: "What is a thermometer used for?", options: ["Measuring temperature", "Measuring wind", "Measuring rain", "Measuring time"], correct: 0 }
                    ],
                    "Forces and Motion": [
                        { question: "What is a force?", options: ["A push or pull", "A type of energy", "A type of matter", "A type of light"], correct: 0 },
                        { question: "What is gravity?", options: ["A force that pulls objects toward Earth", "A force that pushes objects away", "A force that makes objects float", "A force that makes objects disappear"], correct: 0 },
                        { question: "What is friction?", options: ["A force that opposes motion", "A force that helps motion", "A force that creates motion", "A force that destroys motion"], correct: 0 },
                        { question: "What is speed?", options: ["How fast something moves", "How slow something moves", "How big something is", "How heavy something is"], correct: 0 },
                        { question: "What is momentum?", options: ["The tendency of a moving object to keep moving", "The tendency of an object to stop", "The tendency of an object to change direction", "The tendency of an object to disappear"], correct: 0 }
                    ]
                },
                reading: {
                    "Basic Reading Comprehension": [
                        { question: "What is the main idea of a text?", options: ["The first sentence", "The most important point", "The title", "The last sentence"], correct: 1 },
                        { question: "What do supporting details do?", options: ["Contradict the main idea", "Explain or support the main idea", "Replace the main idea", "Hide the main idea"], correct: 1 },
                        { question: "What is a summary?", options: ["A brief retelling of the main points", "A detailed copy of the text", "The title of the text", "The author's name"], correct: 0 },
                        { question: "What is inference?", options: ["A conclusion based on evidence", "A direct statement", "A question", "An opinion"], correct: 0 },
                        { question: "What is context?", options: ["The surrounding information that helps understand meaning", "The title", "The author", "The date"], correct: 0 }
                    ],
                    "Story Elements": [
                        { question: "What is a character?", options: ["A person or animal in a story", "The setting", "The plot", "The theme"], correct: 0 },
                        { question: "What is the setting?", options: ["Where and when the story takes place", "Who the story is about", "What happens in the story", "The lesson of the story"], correct: 0 },
                        { question: "What is the plot?", options: ["The sequence of events in a story", "The characters", "The setting", "The theme"], correct: 0 },
                        { question: "What is the conflict?", options: ["The problem in the story", "The solution", "The characters", "The setting"], correct: 0 },
                        { question: "What is the resolution?", options: ["How the conflict is solved", "The beginning of the story", "The middle of the story", "The characters"], correct: 0 }
                    ],
                    "Vocabulary Building": [
                        { question: "What is a synonym?", options: ["A word with the same meaning", "A word with opposite meaning", "A word that sounds the same", "A word that looks the same"], correct: 0 },
                        { question: "What is an antonym?", options: ["A word with opposite meaning", "A word with the same meaning", "A word that sounds the same", "A word that looks the same"], correct: 0 },
                        { question: "What is a prefix?", options: ["A word part added to the beginning of a word", "A word part added to the end", "The root word", "The meaning"], correct: 0 },
                        { question: "What is a suffix?", options: ["A word part added to the end of a word", "A word part added to the beginning", "The root word", "The meaning"], correct: 0 },
                        { question: "What is context clues?", options: ["Hints in the text that help understand meaning", "The title", "The author", "The date"], correct: 0 }
                    ]
                },
                language: {
                    "Spanish Basics": [
                        { question: "How do you say 'hello' in Spanish?", options: ["Hola", "Adi√≥s", "Gracias", "Por favor"], correct: 0 },
                        { question: "How do you say 'thank you' in Spanish?", options: ["Hola", "Adi√≥s", "Gracias", "Por favor"], correct: 2 },
                        { question: "How do you say 'goodbye' in Spanish?", options: ["Hola", "Adi√≥s", "Gracias", "Por favor"], correct: 1 },
                        { question: "How do you say 'please' in Spanish?", options: ["Hola", "Adi√≥s", "Gracias", "Por favor"], correct: 3 },
                        { question: "What does 's√≠' mean?", options: ["Yes", "No", "Maybe", "Hello"], correct: 0 }
                    ],
                    "French Greetings": [
                        { question: "How do you say 'hello' in French?", options: ["Bonjour", "Au revoir", "Merci", "S'il vous pla√Æt"], correct: 0 },
                        { question: "How do you say 'thank you' in French?", options: ["Bonjour", "Au revoir", "Merci", "S'il vous pla√Æt"], correct: 2 },
                        { question: "How do you say 'goodbye' in French?", options: ["Bonjour", "Au revoir", "Merci", "S'il vous pla√Æt"], correct: 1 },
                        { question: "How do you say 'please' in French?", options: ["Bonjour", "Au revoir", "Merci", "S'il vous pla√Æt"], correct: 3 },
                        { question: "What does 'oui' mean?", options: ["Yes", "No", "Maybe", "Hello"], correct: 0 }
                    ]
                }
            },
            9: {
                math: {
                    "Algebra Basics": [
                        { question: "What is the value of x if 2x + 5 = 13?", options: ["3", "4", "5", "6"], correct: 1 },
                        { question: "Simplify: 3x + 2x", options: ["5x", "6x", "x", "5"], correct: 0 },
                        { question: "What is 2(x + 3)?", options: ["2x + 3", "2x + 6", "x + 6", "2x"], correct: 1 },
                        { question: "Solve for x: x - 7 = 12", options: ["5", "19", "12", "7"], correct: 1 },
                        { question: "What is the coefficient of x in 5x + 3?", options: ["5", "3", "x", "8"], correct: 0 }
                    ],
                    "Quadratic Equations": [
                        { question: "What is the standard form of a quadratic equation?", options: ["ax¬≤ + bx + c = 0", "ax + b = 0", "a¬≤ + b¬≤ = c¬≤", "y = mx + b"], correct: 0 },
                        { question: "What is the solution to x¬≤ = 16?", options: ["4", "¬±4", "8", "¬±8"], correct: 1 },
                        { question: "What is the vertex form of a quadratic?", options: ["y = a(x-h)¬≤ + k", "y = ax¬≤ + bx + c", "y = mx + b", "y = ax"], correct: 0 },
                        { question: "What is the discriminant of x¬≤ + 5x + 6?", options: ["1", "25", "24", "49"], correct: 0 },
                        { question: "How many solutions does x¬≤ + 1 = 0 have?", options: ["0 real solutions", "1 real solution", "2 real solutions", "Infinite solutions"], correct: 0 }
                    ]
                },
                science: {
                    "Cell Biology": [
                        { question: "What is the control center of the cell?", options: ["Nucleus", "Mitochondria", "Ribosome", "Cell membrane"], correct: 0 },
                        { question: "What organelle produces energy?", options: ["Nucleus", "Mitochondria", "Ribosome", "Cell membrane"], correct: 1 },
                        { question: "What is the function of the cell membrane?", options: ["Controls what enters and exits", "Produces energy", "Makes proteins", "Stores DNA"], correct: 0 },
                        { question: "What organelle makes proteins?", options: ["Nucleus", "Mitochondria", "Ribosome", "Cell membrane"], correct: 2 },
                        { question: "What is the difference between plant and animal cells?", options: ["Plant cells have cell walls", "Animal cells have cell walls", "They are identical", "Plant cells have no nucleus"], correct: 0 }
                    ],
                    "Genetics": [
                        { question: "What is DNA?", options: ["Genetic material", "A protein", "A cell", "An organelle"], correct: 0 },
                        { question: "What is a gene?", options: ["A segment of DNA", "A type of cell", "A protein", "An organelle"], correct: 0 },
                        { question: "What is dominant trait?", options: ["A trait that shows even with one copy", "A trait that needs two copies", "A trait that never shows", "A trait that changes"], correct: 0 },
                        { question: "What is a chromosome?", options: ["Structure containing DNA", "A type of cell", "A protein", "An organelle"], correct: 0 },
                        { question: "What is heredity?", options: ["Passing traits from parents to offspring", "Creating new traits", "Destroying traits", "Changing traits"], correct: 0 }
                    ]
                },
                reading: {
                    "Reading Comprehension": [
                        { question: "What is the author's purpose?", options: ["Why the author wrote the text", "Who the author is", "When it was written", "Where it was written"], correct: 0 },
                        { question: "What is theme?", options: ["The main message or lesson", "The setting", "The characters", "The plot"], correct: 0 },
                        { question: "What is tone?", options: ["The author's attitude", "The setting", "The characters", "The plot"], correct: 0 },
                        { question: "What is mood?", options: ["The feeling created for the reader", "The author's attitude", "The setting", "The characters"], correct: 0 },
                        { question: "What is point of view?", options: ["The perspective from which the story is told", "The setting", "The characters", "The plot"], correct: 0 }
                    ],
                    "Literary Analysis": [
                        { question: "What is symbolism?", options: ["Using objects to represent ideas", "The plot", "The characters", "The setting"], correct: 0 },
                        { question: "What is a metaphor?", options: ["A comparison without 'like' or 'as'", "A comparison with 'like' or 'as'", "A description", "A question"], correct: 0 },
                        { question: "What is a simile?", options: ["A comparison with 'like' or 'as'", "A comparison without 'like' or 'as'", "A description", "A question"], correct: 0 },
                        { question: "What is personification?", options: ["Giving human traits to non-human things", "Describing a person", "Creating a character", "Writing dialogue"], correct: 0 },
                        { question: "What is alliteration?", options: ["Repetition of beginning sounds", "Repetition of ending sounds", "Repetition of words", "Repetition of sentences"], correct: 0 }
                    ]
                },
                language: {
                    "Spanish Basics": [
                        { question: "How do you say 'hello' in Spanish?", options: ["Hola", "Adi√≥s", "Gracias", "Por favor"], correct: 0 },
                        { question: "How do you say 'thank you' in Spanish?", options: ["Hola", "Adi√≥s", "Gracias", "Por favor"], correct: 2 },
                        { question: "How do you say 'goodbye' in Spanish?", options: ["Hola", "Adi√≥s", "Gracias", "Por favor"], correct: 1 },
                        { question: "How do you say 'please' in Spanish?", options: ["Hola", "Adi√≥s", "Gracias", "Por favor"], correct: 3 },
                        { question: "What does 's√≠' mean?", options: ["Yes", "No", "Maybe", "Hello"], correct: 0 }
                    ],
                    "French Greetings": [
                        { question: "How do you say 'hello' in French?", options: ["Bonjour", "Au revoir", "Merci", "S'il vous pla√Æt"], correct: 0 },
                        { question: "How do you say 'thank you' in French?", options: ["Bonjour", "Au revoir", "Merci", "S'il vous pla√Æt"], correct: 2 },
                        { question: "How do you say 'goodbye' in French?", options: ["Bonjour", "Au revoir", "Merci", "S'il vous pla√Æt"], correct: 1 },
                        { question: "How do you say 'please' in French?", options: ["Bonjour", "Au revoir", "Merci", "S'il vous pla√Æt"], correct: 3 },
                        { question: "What does 'oui' mean?", options: ["Yes", "No", "Maybe", "Hello"], correct: 0 }
                    ]
                }
            }
        };

        // Generate questions from lesson-based quiz data
        function generateQuestionsForLevel(level) {
            const grade = getGradeLevel();
            const selectedSubjects = getSelectedSubjects();
            const allQuestions = [];
            
            // Get questions from all selected subjects for the user's grade
            const gradeData = quizQuestionsByGrade[grade] || quizQuestionsByGrade[9];
            
            selectedSubjects.forEach(subjectId => {
                const subjectData = gradeData[subjectId];
                if (subjectData) {
                    Object.keys(subjectData).forEach(lessonTitle => {
                        const lessonQuestions = subjectData[lessonTitle];
                        allQuestions.push(...lessonQuestions);
                    });
                }
            });
            
            // If no questions found, use fallback questions
            if (allQuestions.length === 0) {
                return getFallbackQuestions(level);
            }
            
            // Shuffle and select questions for this level
            const shuffled = [...allQuestions].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, QUESTIONS_PER_LEVEL);
        }

        // Fallback questions if no lesson data available
        function getFallbackQuestions(level) {
            const baseQuestions = [
                { question: "What is 5 + 3?", options: ["6", "7", "8", "9"], correct: 2 },
                { question: "What is 10 - 4?", options: ["4", "5", "6", "7"], correct: 2 },
                { question: "What is 12 √ó 3?", options: ["33", "34", "35", "36"], correct: 3 },
                { question: "What is 15 √∑ 3?", options: ["3", "4", "5", "6"], correct: 2 },
                { question: "What is 20 √ó 5?", options: ["95", "100", "105", "110"], correct: 1 },
                { question: "What is 8 + 7?", options: ["14", "15", "16", "17"], correct: 1 },
                { question: "What is 25 - 8?", options: ["15", "16", "17", "18"], correct: 2 },
                { question: "What is 9 √ó 4?", options: ["34", "35", "36", "37"], correct: 2 },
                { question: "What is 6 √ó 7?", options: ["40", "41", "42", "43"], correct: 2 },
                { question: "What is 100 √∑ 4?", options: ["20", "25", "30", "35"], correct: 1 }
            ];
            return baseQuestions;
        }

        function initGame() {
            currentLevel = parseInt(localStorage.getItem('astrolearn_game_level') || '1');
            planetsReached = parseInt(localStorage.getItem('astrolearn_planets_reached') || '0');
            gameXP = parseInt(localStorage.getItem('astrolearn_game_xp') || '0');
            
            updateStats();
            loadLevel(currentLevel);
        }

        function loadLevel(level) {
            questions = generateQuestionsForLevel(level);
            currentQuestion = 0;
            currentPlanet = 0;
            userAnswers = [];
            
            // Ensure both game and question areas are visible
            const gameContainerParent = document.getElementById('gameContainer').parentElement;
            if (gameContainerParent) {
                gameContainerParent.style.display = 'block';
            }
            
            renderGameScene();
            showQuestion();
        }

        function renderGameScene() {
            const container = document.getElementById('gameContainer');
            container.innerHTML = '';
            
            // Render planets (10 planets for 10 questions)
            const planetEmojis = ['ü™ê', 'üåç', 'üåï', 'üî¥', 'üü†', 'üü£', 'üîµ', 'üü¢', 'üü°', '‚ö™'];
            const planetColors = ['#4FC3F7', '#FF6EC7', '#FFD700', '#FF6B6B', '#FFA500', '#9B59B6', '#3498DB', '#2ECC71', '#F1C40F', '#ECF0F1'];
            
            const numPlanets = Math.min(QUESTIONS_PER_LEVEL, questions.length);
            const spacing = 80 / (numPlanets - 1); // Distribute planets across 80% of width
            
            for (let i = 0; i < numPlanets; i++) {
                const planet = document.createElement('div');
                planet.className = `planet ${i <= currentPlanet ? 'reached' : ''}`;
                planet.style.left = `${10 + i * spacing}%`;
                planet.style.top = `${20 + (i % 3) * 25}%`; // Vary height more
                planet.style.color = planetColors[i % planetColors.length];
                planet.textContent = planetEmojis[i % planetEmojis.length];
                planet.id = `planet-${i}`;
                container.appendChild(planet);
            }
            
            // Render spaceship
            const spaceship = document.createElement('div');
            spaceship.className = 'spaceship';
            spaceship.id = 'spaceship';
            spaceship.textContent = 'üöÄ';
            spaceship.style.left = `${10 + currentPlanet * spacing}%`;
            spaceship.style.top = `${20 + (currentPlanet % 3) * 25}%`;
            spaceship.style.transform = 'translate(-50%, -50%)';
            container.appendChild(spaceship);
        }

        function showQuestion() {
            if (currentQuestion >= questions.length) {
                // All questions answered correctly - show black hole
                showBlackHole();
                return;
            }
            
            const question = questions[currentQuestion];
            document.getElementById('questionNumber').textContent = currentQuestion + 1;
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = question.options.map((option, index) => `
                <button class="glass-card p-4 text-left hover:scale-105 transition-transform option-btn" 
                        data-answer="${index}">
                    <span class="font-bold text-[#4FC3F7] mr-2">${String.fromCharCode(65 + index)}.</span>
                    ${option}
                </button>
            `).join('');
            
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const selectedAnswer = parseInt(btn.dataset.answer);
                    checkAnswer(selectedAnswer);
                });
            });
            
            document.getElementById('questionArea').classList.remove('hidden');
            // Ensure game container is visible
            document.getElementById('gameContainer').parentElement.style.display = 'block';
        }

        function checkAnswer(selectedAnswer) {
            const question = questions[currentQuestion];
            userAnswers.push(selectedAnswer);
            
            if (selectedAnswer === question.correct) {
                // Correct answer - move to next planet
                currentPlanet++;
                planetsReached++;
                gameXP += 50;
                updateStats();
                renderGameScene();
                
                // Move spaceship
                setTimeout(() => {
                    const spaceship = document.getElementById('spaceship');
                    const numPlanets = Math.min(QUESTIONS_PER_LEVEL, questions.length);
                    const spacing = 80 / (numPlanets - 1);
                    spaceship.style.left = `${10 + currentPlanet * spacing}%`;
                    spaceship.style.top = `${20 + (currentPlanet % 3) * 25}%`;
                }, 100);
                
                currentQuestion++;
                
                if (currentQuestion >= questions.length) {
                    // Level complete
                    setTimeout(() => {
                        showBlackHole();
                    }, 1000);
                } else {
                    setTimeout(() => {
                        showQuestion();
                    }, 1000);
                }
            } else {
                // Wrong answer - asteroid hit
                showAsteroidHit();
            }
        }

        function showAsteroidHit() {
            const container = document.getElementById('gameContainer');
            const spaceship = document.getElementById('spaceship');
            
            // Create asteroid
            const asteroid = document.createElement('div');
            asteroid.className = 'asteroid';
            asteroid.textContent = '‚òÑÔ∏è';
            asteroid.style.left = spaceship.style.left;
            asteroid.style.top = '0%';
            container.appendChild(asteroid);
            
            // Create explosion
            setTimeout(() => {
                const explosion = document.createElement('div');
                explosion.className = 'explosion';
                explosion.textContent = 'üí•';
                explosion.style.left = spaceship.style.left;
                explosion.style.top = spaceship.style.top;
                container.appendChild(explosion);
                
                setTimeout(() => {
                    // Keep game visible but hide question area during game over
                    document.getElementById('questionArea').classList.add('hidden');
                    document.getElementById('gameOverModal').classList.remove('hidden');
                }, 500);
            }, 500);
        }

        function showBlackHole() {
            const container = document.getElementById('gameContainer');
            // Hide question area but keep game visible
            document.getElementById('questionArea').classList.add('hidden');
            
            const blackhole = document.createElement('div');
            blackhole.className = 'blackhole';
            blackhole.textContent = 'üï≥Ô∏è';
            container.appendChild(blackhole);
            
            setTimeout(() => {
                document.getElementById('levelCompleteModal').classList.remove('hidden');
            }, 2000);
        }

        function updateStats() {
            document.getElementById('currentLevel').textContent = currentLevel;
            document.getElementById('planetsReached').textContent = planetsReached;
            document.getElementById('gameXP').textContent = gameXP;
            
            localStorage.setItem('astrolearn_game_level', currentLevel.toString());
            localStorage.setItem('astrolearn_planets_reached', planetsReached.toString());
            localStorage.setItem('astrolearn_game_xp', gameXP.toString());
        }

        // Event listeners
        document.getElementById('nextLevelBtn').addEventListener('click', () => {
            currentLevel++;
            document.getElementById('levelCompleteModal').classList.add('hidden');
            loadLevel(currentLevel);
        });

        document.getElementById('restartGameBtn').addEventListener('click', () => {
            currentLevel = 1;
            planetsReached = 0;
            gameXP = 0;
            updateStats();
            document.getElementById('levelCompleteModal').classList.add('hidden');
            loadLevel(1);
        });

        document.getElementById('restartAfterAsteroidBtn').addEventListener('click', () => {
            document.getElementById('gameOverModal').classList.add('hidden');
            loadLevel(currentLevel);
        });
    </script>
</body>
</html>
