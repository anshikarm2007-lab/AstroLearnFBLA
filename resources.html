<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Constellations - AstroLearn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gradient-to-br from-[#0B0F2F] via-[#482880] to-[#0B0F2F] min-h-screen text-[#F5F7FA] overflow-x-hidden">
    <!-- Floating Stars Background -->
    <div id="floatingStars"></div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <img src="sticker.webp" alt="AstroLearn Logo" class="h-8 w-8 object-contain">
                <h1 class="text-2xl font-bold bg-gradient-to-r from-[#4FC3F7] to-[#FF6EC7] bg-clip-text text-transparent">
                    AstroLearn
                </h1>
            </div>
            <div class="hidden md:flex space-x-6 items-center">
                <a href="index.html" class="nav-link">Home</a>
                <a href="dashboard.html" class="nav-link protected-link">Dashboard</a>
                <a href="schedule.html" class="nav-link protected-link">Schedule</a>
                <a href="resources.html" class="nav-link active protected-link">Resources</a>
                <a href="game.html" class="nav-link protected-link">Space Quest</a>
                <a href="login.html" class="btn-secondary py-2 px-4 text-sm" id="authBtn">Sign In</a>
            </div>
            <button class="md:hidden text-2xl" id="mobileMenuBtn">‚ò∞</button>
        </div>
        <div class="md:hidden hidden" id="mobileMenu">
            <div class="flex flex-col space-y-2 p-4">
                <a href="index.html" class="nav-link">Home</a>
                <a href="dashboard.html" class="nav-link">Dashboard</a>
                <a href="schedule.html" class="nav-link">Schedule</a>
                <a href="resources.html" class="nav-link">Resources</a>
                <a href="game.html" class="nav-link protected-link">Space Quest</a>
                <a href="login.html" class="btn-secondary py-2 px-4 text-center block" id="authBtnMobile">Sign In</a>
            </div>
        </div>
    </nav>

    <!-- Resources Header -->
    <section class="container mx-auto px-6 py-16 text-center">
        <h1 class="text-5xl md:text-7xl font-bold mb-4">
            <span class="bg-gradient-to-r from-[#4FC3F7] to-[#FF6EC7] bg-clip-text text-transparent">
                Knowledge Constellations
            </span>
        </h1>
        <p class="text-xl text-[#F5F7FA]/80">Choose your mission pathway</p>
    </section>

    <!-- Quick Access -->
    <section class="container mx-auto px-6 mb-12">
        <h2 class="text-3xl font-bold mb-6 text-center">
            <span class="bg-gradient-to-r from-[#4FC3F7] to-[#FF6EC7] bg-clip-text text-transparent">
                Interactive Tools
            </span>
        </h2>
        <div class="grid md:grid-cols-3 gap-6">
            <button id="starMapBtn" class="glass-card p-6 text-center hover:scale-105 transition-transform cursor-pointer">
                <div class="text-4xl mb-3">üì•</div>
                <h3 class="text-lg font-bold mb-2">Download Materials</h3>
                <p class="text-sm text-[#F5F7FA]/70">Study guides & resources</p>
            </button>
            <a href="flashcards.html" class="glass-card p-6 text-center hover:scale-105 transition-transform cursor-pointer block">
                <div class="text-4xl mb-3">üìö</div>
                <h3 class="text-lg font-bold mb-2">Flashcards</h3>
                <p class="text-sm text-[#F5F7FA]/70">Interactive study cards</p>
            </a>
            <a href="quizzes.html" class="glass-card p-6 text-center hover:scale-105 transition-transform cursor-pointer block">
                <div class="text-4xl mb-3">üìù</div>
                <h3 class="text-lg font-bold mb-2">Quizzes</h3>
                <p class="text-sm text-[#F5F7FA]/70">Test your knowledge</p>
            </a>
        </div>
    </section>

    <!-- Educational Videos Section -->
    <section class="container mx-auto px-6 mb-12">
        <h2 class="text-3xl font-bold mb-8 text-center">
            <span class="bg-gradient-to-r from-[#4FC3F7] to-[#FF6EC7] bg-clip-text text-transparent">
                üìπ Educational Videos
            </span>
        </h2>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="videosGrid">
            <!-- Videos will be populated by JS -->
        </div>
    </section>

    <!-- Downloadable Materials Section -->
    <section class="container mx-auto px-6 mb-12">
        <h2 class="text-3xl font-bold mb-8 text-center">
            <span class="bg-gradient-to-r from-[#4FC3F7] to-[#FF6EC7] bg-clip-text text-transparent">
                üì• Downloadable Materials
            </span>
        </h2>
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6" id="downloadsGrid">
            <!-- Downloadable materials will be populated by JS -->
        </div>
    </section>

    <!-- Lessons Grid -->
    <section class="container mx-auto px-6 pb-16">
        <h2 class="text-3xl font-bold mb-8 text-center">
            <span class="bg-gradient-to-r from-[#4FC3F7] to-[#FF6EC7] bg-clip-text text-transparent">
                Available Lessons
            </span>
        </h2>
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6" id="lessonsGrid">
            <!-- Lessons will be populated by JS -->
                            </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container mx-auto px-6 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p class="text-sm text-[#F5F7FA]/70 flex items-center gap-1"><img src="sticker.webp" alt="AstroLearn Logo" class="h-5 w-5 object-contain"> Powered by AstroLearn</p>
                            </div>
                <div class="flex space-x-6">
                    <a href="about.html" class="footer-link">About</a>
                    <a href="contact.html" class="footer-link">Contact</a>
                    <a href="privacy.html" class="footer-link">Privacy</a>
                            </div>
                        </div>
                    </div>
    </footer>

    <!-- Star Map Roadmap Modal -->
    <div id="starMapModal" class="star-map-modal hidden">
        <div class="star-map-overlay" id="starMapOverlay"></div>
        <div class="star-map-content">
            <div class="star-map-header">
                <h2 class="text-3xl md:text-4xl font-bold mb-2">
                    <span class="bg-gradient-to-r from-[#4FC3F7] to-[#FF6EC7] bg-clip-text text-transparent">
                        Your Learning Roadmap
                    </span>
                </h2>
                <p class="text-[#F5F7FA]/70">Your personalized pace chart through the stars</p>
                <button id="closeStarMap" class="close-btn">‚úï</button>
                            </div>
            <div class="star-map-body" id="roadmapContent">
                <!-- Roadmap will be generated here -->
                            </div>
            <div class="star-map-footer">
                <button class="btn-primary" onclick="downloadRoadmap()">Download as PDF</button>
                <button class="btn-secondary" id="closeStarMapBtn">Close</button>
                            </div>
                        </div>
                    </div>

    <script src="script.js"></script>
    <script src="lesson.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Check authentication before loading page
        document.addEventListener('DOMContentLoaded', () => {
            if (!checkAuth()) {
                return; // Will redirect to login
            }
            updateNavigation();
            loadLessons();
            loadVideos();
            loadDownloads();
        });

        const lessons = [
            { id: 1, title: "Algebra Basics", subject: "Math", difficulty: "Easy", icon: "üî≠", color: "#4FC3F7" },
            { id: 2, title: "Cell Structure", subject: "Biology", difficulty: "Medium", icon: "üß¨", color: "#FF6EC7" },
            { id: 3, title: "World War II", subject: "History", difficulty: "Medium", icon: "üåç", color: "#482880" },
            { id: 4, title: "Periodic Table", subject: "Chemistry", difficulty: "Hard", icon: "‚öóÔ∏è", color: "#4FC3F7" },
            { id: 5, title: "Quantum Physics", subject: "Physics", difficulty: "Hard", icon: "üåå", color: "#FF6EC7" },
            { id: 6, title: "Shakespeare", subject: "Literature", difficulty: "Medium", icon: "üìö", color: "#482880" },
            { id: 7, title: "Calculus I", subject: "Math", difficulty: "Hard", icon: "üî≠", color: "#4FC3F7" },
            { id: 8, title: "Genetics", subject: "Biology", difficulty: "Medium", icon: "üß¨", color: "#FF6EC7" }
        ];

        function getDifficultyColor(difficulty) {
            switch(difficulty) {
                case 'Easy': return '#4FC3F7';
                case 'Medium': return '#FF6EC7';
                case 'Hard': return '#482880';
                default: return '#4FC3F7';
            }
        }

        function loadLessons() {
            const grid = document.getElementById('lessonsGrid');
            if (!grid) return;
            
            // Get user's grade level from preferences
            const prefs = JSON.parse(localStorage.getItem('astrolearn_preferences') || '{}');
            const grade = prefs.grade || 9;
            
            // Get lessons for each subject
            const subjects = ['math', 'science', 'reading', 'language'];
            let allLessons = [];
            
            subjects.forEach(subject => {
                const subjectLessons = getLessonsForSubject(subject, grade);
                subjectLessons.forEach(lesson => {
                    allLessons.push({
                        ...lesson,
                        subject: subject.charAt(0).toUpperCase() + subject.slice(1),
                        icon: subject === 'math' ? 'üî≠' : subject === 'science' ? 'üß¨' : subject === 'reading' ? 'üìö' : 'üåç',
                        difficulty: grade <= 8 ? 'Easy' : grade <= 10 ? 'Medium' : 'Hard'
                    });
                });
            });
            
            if (allLessons.length === 0) {
                grid.innerHTML = '<p class="col-span-full text-center text-[#F5F7FA]/70">No lessons available. Please select a grade level.</p>';
                return;
            }
            
            grid.innerHTML = allLessons.map(lesson => {
                const isCompleted = isLessonCompleted(lesson.id);
                return `
                <div class="lesson-card glass-card p-6 hover:scale-105 transition-transform ${isCompleted ? 'border-2 border-green-500' : ''}" style="animation-delay: ${Math.random() * 2}s">
                    <div class="flex items-center justify-between mb-2">
                        <div class="text-5xl">${lesson.icon}</div>
                        ${isCompleted ? '<span class="text-2xl">‚úÖ</span>' : ''}
                    </div>
                    <h3 class="text-xl font-bold mb-2">${lesson.title}</h3>
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-sm text-[#F5F7FA]/70">${lesson.subject} - Grade ${lesson.grade}</span>
                        <span class="px-3 py-1 rounded-full text-xs font-bold" style="background: ${getDifficultyColor(lesson.difficulty)}33; color: ${getDifficultyColor(lesson.difficulty)}">
                            ${lesson.difficulty}
                        </span>
                    </div>
                    <button class="btn-primary w-full" onclick="openLesson('${lesson.id}', '${lesson.subject.toLowerCase()}')">
                        ${isCompleted ? 'Review Lesson' : 'Start Lesson'}
                    </button>
                </div>
            `;
            }).join('');
        }
        
        function openLesson(lessonId, subject) {
            // Get user's grade level from preferences
            const prefs = JSON.parse(localStorage.getItem('astrolearn_preferences') || '{}');
            const grade = prefs.grade || 9;
            
            // Try to find lesson in user's grade first
            let lessons = getLessonsForSubject(subject, grade);
            let lesson = lessons.find(l => l.id === lessonId);
            
            if (!lesson) {
                // Try to find in all grades
                const allGrades = [6, 9, 12];
                for (let g of allGrades) {
                    const gradeLessons = getLessonsForSubject(subject, g);
                    const found = gradeLessons.find(l => l.id === lessonId);
                    if (found) {
                        showLessonModal(found);
                        return;
                    }
                }
                alert('Lesson not found');
                return;
            }
            showLessonModal(lesson);
        }
        
        function showLessonModal(lesson) {
            const isCompleted = isLessonCompleted(lesson.id);
            const modal = document.getElementById('lessonModal');
            if (!modal) {
                createLessonModal();
            }
            
            document.getElementById('lessonTitle').textContent = lesson.title;
            // Format content with proper paragraph breaks for better readability
            const contentDiv = document.getElementById('lessonContent');
            // Split content into sentences and create paragraphs
            const sentences = lesson.content.split(/\. /).filter(s => s.trim().length > 0);
            const paragraphs = [];
            let currentPara = [];
            
            // Group sentences into paragraphs (3-4 sentences per paragraph for readability)
            sentences.forEach((sentence, index) => {
                currentPara.push(sentence + (sentence.endsWith('.') ? '' : '.'));
                if (currentPara.length >= 3 || index === sentences.length - 1) {
                    paragraphs.push(currentPara.join(' '));
                    currentPara = [];
                }
            });
            
            // Create paragraph elements
            contentDiv.innerHTML = paragraphs.map(p => `<p class="mb-4">${p}</p>`).join('');
            document.getElementById('lessonExamples').innerHTML = lesson.examples.map(ex => `<li class="mb-2">${ex}</li>`).join('');
            document.getElementById('lessonGrade').textContent = `Grade ${lesson.grade}`;
            
            const completeBtn = document.getElementById('completeLessonBtn');
            const restartBtn = document.getElementById('restartLessonBtn');
            
            if (isCompleted) {
                completeBtn.textContent = '‚úì Lesson Completed';
                completeBtn.disabled = true;
                completeBtn.classList.add('opacity-50');
                restartBtn.style.display = 'inline-block';
            } else {
                completeBtn.textContent = 'Complete Lesson';
                completeBtn.disabled = false;
                completeBtn.classList.remove('opacity-50');
                restartBtn.style.display = 'none';
            }
            
            completeBtn.onclick = () => {
                if (!isCompleted) {
                    completeLesson(lesson.id, lesson.id.split('_')[0]);
                    showLessonModal(lesson); // Refresh modal
                    loadLessons(); // Refresh lesson grid
                }
            };
            
            restartBtn.onclick = () => {
                resetLesson(lesson.id);
                showLessonModal(lesson); // Refresh modal
                loadLessons(); // Refresh lesson grid
            };
            
            document.getElementById('lessonModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        function createLessonModal() {
            const modalHTML = `
                <div id="lessonModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div class="fixed inset-0 bg-black/70" onclick="closeLessonModal()"></div>
                    <div class="relative glass-card p-8 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                        <button onclick="closeLessonModal()" class="absolute top-4 right-4 text-3xl text-[#F5F7FA]/70 hover:text-[#F5F7FA] z-10">√ó</button>
                        <h2 id="lessonTitle" class="text-3xl font-bold mb-4 pr-8"></h2>
                        <p class="text-sm text-[#F5F7FA]/60 mb-6" id="lessonGrade"></p>
                        <div class="mb-6">
                            <h3 class="text-xl font-bold mb-3 text-[#4FC3F7]">Lesson Content</h3>
                            <div id="lessonContent" class="text-base text-[#F5F7FA]/90 leading-relaxed space-y-4 whitespace-pre-line"></div>
                        </div>
                        <div class="mb-6">
                            <h3 class="text-xl font-bold mb-3 text-[#4FC3F7]">Key Examples</h3>
                            <ul id="lessonExamples" class="list-disc list-inside space-y-2 text-[#F5F7FA]/90 ml-4"></ul>
                        </div>
                        <div class="flex gap-4 mt-6 pt-4 border-t border-[#F5F7FA]/20">
                            <button id="completeLessonBtn" class="btn-primary flex-1">Complete Lesson</button>
                            <button id="restartLessonBtn" class="btn-secondary" style="display: none;">Restart Lesson</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }
        
        function closeLessonModal() {
            document.getElementById('lessonModal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        // Get assignments from localStorage or use default
        function getAssignments() {
            const stored = localStorage.getItem('astrolearn_assignments');
            if (stored) {
                return JSON.parse(stored);
            }
            // Default assignments with future dates
            const today = new Date();
            const defaultAssignments = [
                { id: 1, title: "Algebra Chapter 5", subject: "Math", dueDate: getFutureDate(3), priority: "High", status: "pending", estimatedHours: 3 },
                { id: 2, title: "Biology Lab Report", subject: "Science", dueDate: getFutureDate(6), priority: "High", status: "in-progress", estimatedHours: 4 },
                { id: 3, title: "Reading Comprehension Quiz", subject: "Reading", dueDate: getFutureDate(8), priority: "Medium", status: "pending", estimatedHours: 1 },
                { id: 4, title: "Spanish Vocabulary Practice", subject: "Language", dueDate: getFutureDate(10), priority: "Medium", status: "pending", estimatedHours: 2 },
                { id: 5, title: "Geometry Problem Set", subject: "Math", dueDate: getFutureDate(13), priority: "Low", status: "pending", estimatedHours: 2 },
                { id: 6, title: "Chemistry Experiment", subject: "Science", dueDate: getFutureDate(16), priority: "High", status: "pending", estimatedHours: 5 },
                { id: 7, title: "Literature Essay", subject: "Reading", dueDate: getFutureDate(19), priority: "Medium", status: "pending", estimatedHours: 4 },
                { id: 8, title: "French Conversation Practice", subject: "Language", dueDate: getFutureDate(23), priority: "Low", status: "pending", estimatedHours: 1 }
            ];
            saveAssignments(defaultAssignments);
            return defaultAssignments;
        }

        function getFutureDate(daysFromNow) {
            const date = new Date();
            date.setDate(date.getDate() + daysFromNow);
            return date.toISOString().split('T')[0];
        }

        function saveAssignments(assignments) {
            localStorage.setItem('astrolearn_assignments', JSON.stringify(assignments));
        }

        let assignments = getAssignments();
        let nextId = Math.max(...assignments.map(a => a.id), 0) + 1;

        function generateRoadmap() {
            const roadmapContent = document.getElementById('roadmapContent');
            
            // Sort assignments by due date
            const sortedAssignments = [...assignments].sort((a, b) => 
                new Date(a.dueDate) - new Date(b.dueDate)
            );
            
            // Calculate timeline
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (sortedAssignments.length === 0) {
                roadmapContent.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">üåü</div>
                        <h3 class="text-2xl font-bold mb-2">No Assignments Yet</h3>
                        <p class="text-[#F5F7FA]/70 mb-6">Click "Add Assignment" to get started!</p>
                        <button class="btn-primary" onclick="showAddAssignmentForm()">Add Your First Assignment</button>
                    </div>
                `;
                return;
            }
            
            const lastDueDate = new Date(sortedAssignments[sortedAssignments.length - 1].dueDate);
            lastDueDate.setHours(0, 0, 0, 0);
            const totalDays = Math.max(0, Math.ceil((lastDueDate - today) / (1000 * 60 * 60 * 24)));
            
            // Group by week - only include future assignments
            const weeklyPlan = {};
            sortedAssignments.forEach(assignment => {
                const dueDate = new Date(assignment.dueDate);
                dueDate.setHours(0, 0, 0, 0);
                const daysUntilDue = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                
                // Only include assignments that are due today or in the future
                if (daysUntilDue >= 0) {
                    const week = Math.floor(daysUntilDue / 7) + 1;
                    if (week > 0) {
                        if (!weeklyPlan[week]) {
                            weeklyPlan[week] = [];
                        }
                        weeklyPlan[week].push(assignment);
                    }
                }
            });
            
            // Generate roadmap HTML
            const futureAssignments = sortedAssignments.filter(a => {
                const dueDate = new Date(a.dueDate);
                dueDate.setHours(0, 0, 0, 0);
                return dueDate >= today;
            });
            
            let roadmapHTML = `
                <div class="roadmap-summary mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">Summary</h3>
                        <button class="btn-primary text-sm py-2 px-4" onclick="showAddAssignmentForm()">
                            ‚ûï Add Assignment
                        </button>
                            </div>
                    <div class="grid md:grid-cols-3 gap-4 mb-6">
                        <div class="glass-card p-4 text-center">
                            <div class="text-2xl mb-2">üìÖ</div>
                            <div class="text-2xl font-bold text-[#4FC3F7]">${futureAssignments.length}</div>
                            <div class="text-sm text-[#F5F7FA]/70">Total Assignments</div>
                        </div>
                        <div class="glass-card p-4 text-center">
                            <div class="text-2xl mb-2">‚è∞</div>
                            <div class="text-2xl font-bold text-[#FF6EC7]">${futureAssignments.reduce((sum, a) => sum + a.estimatedHours, 0)}</div>
                            <div class="text-sm text-[#F5F7FA]/70">Total Hours</div>
                        </div>
                        <div class="glass-card p-4 text-center">
                            <div class="text-2xl mb-2">üìÜ</div>
                            <div class="text-2xl font-bold text-[#482880]">${totalDays}</div>
                            <div class="text-sm text-[#F5F7FA]/70">Days Remaining</div>
                        </div>
                    </div>
                </div>

                <div class="roadmap-timeline" id="roadmapTimeline">
            `;
            
            // Create timeline visualization
            const sortedWeeks = Object.keys(weeklyPlan).sort((a, b) => parseInt(a) - parseInt(b));
            
            if (sortedWeeks.length === 0) {
                roadmapHTML += `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">üåü</div>
                        <h3 class="text-2xl font-bold mb-2">No Upcoming Assignments</h3>
                        <p class="text-[#F5F7FA]/70 mb-6">Add assignments to see your roadmap!</p>
                            </div>
                `;
            } else {
                sortedWeeks.forEach((week, weekIndex) => {
                    const weekAssignments = weeklyPlan[week];
                    const weekNum = parseInt(week);
                    const displayWeekNum = weekIndex + 1; // Display as Week 1, Week 2, etc.
                    const weekStartDate = new Date(today);
                    weekStartDate.setDate(today.getDate() + (weekNum - 1) * 7);
                    const weekEndDate = new Date(weekStartDate);
                    weekEndDate.setDate(weekStartDate.getDate() + 6);
                
                roadmapHTML += `
                    <div class="roadmap-week mb-8">
                        <div class="week-header mb-4">
                            <h3 class="text-2xl font-bold mb-2">
                                <span class="bg-gradient-to-r from-[#4FC3F7] to-[#FF6EC7] bg-clip-text text-transparent">
                                    Week ${displayWeekNum}
                                </span>
                            </h3>
                            <p class="text-sm text-[#F5F7FA]/70">
                                ${weekStartDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - 
                                ${weekEndDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} ‚Ä¢ 
                                ${weekAssignments.length} assignment${weekAssignments.length !== 1 ? 's' : ''}
                            </p>
                            </div>
                        <div class="roadmap-path">
                `;
                
                    weekAssignments.forEach((assignment, index) => {
                        const dueDate = new Date(assignment.dueDate);
                        const daysUntilDue = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                        const priorityColors = {
                            'High': '#FF6EC7',
                            'Medium': '#4FC3F7',
                            'Low': '#482880'
                        };
                        const statusIcons = {
                            'pending': '‚è≥',
                            'in-progress': 'üöÄ',
                            'completed': '‚úÖ'
                        };
                        
                        roadmapHTML += `
                            <div class="roadmap-milestone draggable-milestone" 
                                 draggable="true" 
                                 data-assignment-id="${assignment.id}"
                                 style="--priority-color: ${priorityColors[assignment.priority]}">
                                <div class="milestone-line"></div>
                                <div class="milestone-star">‚≠ê</div>
                                <div class="milestone-content glass-card p-4">
                                    <div class="flex items-start justify-between mb-2">
                                        <div class="flex-1">
                                            <h4 class="font-bold text-lg mb-1">${assignment.title}</h4>
                                            <p class="text-sm text-[#F5F7FA]/70 mb-2">${assignment.subject}</p>
                            </div>
                                        <div class="flex items-center gap-2">
                                            <div class="text-2xl">${statusIcons[assignment.status]}</div>
                                            <button class="delete-assignment-btn text-red-400 hover:text-red-300 text-xl" 
                                                    onclick="removeAssignment(${assignment.id})" 
                                                    title="Delete assignment">
                                                üóëÔ∏è
                                            </button>
                        </div>
                    </div>
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="px-2 py-1 rounded" style="background: ${priorityColors[assignment.priority]}33; color: ${priorityColors[assignment.priority]}">
                                            ${assignment.priority} Priority
                                        </span>
                                        <span class="text-[#F5F7FA]/70">
                                            Due: ${dueDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                                        </span>
                                </div>
                                    <div class="mt-2 text-xs text-[#F5F7FA]/60">
                                        ‚è±Ô∏è ${assignment.estimatedHours} hours estimated
                            </div>
                                </div>
                            </div>
                        `;
                    });
                
                    roadmapHTML += `
                        </div>
                    </div>
                    `;
                });
            }
            
            roadmapHTML += `</div>`;
            roadmapContent.innerHTML = roadmapHTML;
            
            // Setup drag and drop
            setupDragAndDrop();
        }

        function showAddAssignmentForm() {
            const formHTML = `
                <div class="add-assignment-form glass-card p-6 max-w-md mx-auto">
                    <h3 class="text-2xl font-bold mb-4">Add New Assignment</h3>
                    <form id="addAssignmentForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Title</label>
                            <input type="text" id="assignmentTitle" required 
                                   class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-[#F5F7FA]"
                                   placeholder="e.g., Algebra Chapter 5">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Subject</label>
                            <input type="text" id="assignmentSubject" required 
                                   class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-[#F5F7FA]"
                                   placeholder="e.g., Math, Science, Reading">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Due Date</label>
                            <input type="date" id="assignmentDueDate" required
                                   class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-[#F5F7FA]">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Priority</label>
                            <select id="assignmentPriority" required
                                    class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-[#F5F7FA]">
                                <option value="High">High</option>
                                <option value="Medium" selected>Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Estimated Hours</label>
                            <input type="number" id="assignmentHours" required min="1"
                                   class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-[#F5F7FA]"
                                   placeholder="e.g., 3" value="2">
                        </div>
                        <div class="flex gap-3">
                            <button type="submit" class="btn-primary flex-1">Add Assignment</button>
                            <button type="button" onclick="closeAddForm()" class="btn-secondary flex-1">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
            
            const roadmapContent = document.getElementById('roadmapContent');
            roadmapContent.innerHTML = formHTML;
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('assignmentDueDate').min = today;
            
            document.getElementById('addAssignmentForm').addEventListener('submit', (e) => {
                e.preventDefault();
                addAssignment();
            });
        }

        function addAssignment() {
            const title = document.getElementById('assignmentTitle').value;
            const subject = document.getElementById('assignmentSubject').value;
            const dueDate = document.getElementById('assignmentDueDate').value;
            const priority = document.getElementById('assignmentPriority').value;
            const estimatedHours = parseInt(document.getElementById('assignmentHours').value);
            
            const newAssignment = {
                id: nextId++,
                title,
                subject,
                dueDate,
                priority,
                status: 'pending',
                estimatedHours
            };
            
            assignments.push(newAssignment);
            saveAssignments(assignments);
            generateRoadmap();
        }

        function removeAssignment(id) {
            if (confirm('Are you sure you want to remove this assignment?')) {
                assignments = assignments.filter(a => a.id !== id);
                saveAssignments(assignments);
                generateRoadmap();
            }
        }

        function closeAddForm() {
            generateRoadmap();
        }

        function setupDragAndDrop() {
            const milestones = document.querySelectorAll('.draggable-milestone');
            const roadmapPaths = document.querySelectorAll('.roadmap-path');
            const timeline = document.getElementById('roadmapTimeline');
            
            milestones.forEach(milestone => {
                milestone.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', milestone.dataset.assignmentId);
                    e.dataTransfer.effectAllowed = 'move';
                    milestone.classList.add('dragging');
                });
                
                milestone.addEventListener('dragend', (e) => {
                    milestone.classList.remove('dragging');
                    // Remove any drop indicators
                    document.querySelectorAll('.drop-indicator').forEach(ind => ind.remove());
                });
            });
            
            // Make each roadmap-path a drop zone
            roadmapPaths.forEach(path => {
                path.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    
                    const afterElement = getDragAfterElement(path, e.clientY);
                    const draggable = document.querySelector('.dragging');
                    if (draggable == null) return;
                    
                    // Remove existing indicators
                    document.querySelectorAll('.drop-indicator').forEach(ind => ind.remove());
                    
                    // Add drop indicator
                    const indicator = document.createElement('div');
                    indicator.className = 'drop-indicator';
                    indicator.style.height = '4px';
                    indicator.style.background = '#4FC3F7';
                    indicator.style.margin = '0.5rem 0';
                    indicator.style.borderRadius = '2px';
                    indicator.style.opacity = '0.8';
                    
                    if (afterElement == null) {
                        path.appendChild(indicator);
                    } else {
                        path.insertBefore(indicator, afterElement);
                    }
                });
                
                path.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const assignmentId = parseInt(e.dataTransfer.getData('text/plain'));
                    
                    // Find the assignment
                    const assignment = assignments.find(a => a.id === assignmentId);
                    if (!assignment) return;
                    
                    // Get the drop position
                    const afterElement = getDragAfterElement(path, e.clientY);
                    const milestones = Array.from(path.querySelectorAll('.draggable-milestone:not(.dragging)'));
                    
                    // Calculate new due date based on position
                    let newDueDate = assignment.dueDate; // Keep original if we can't determine
                    
                    if (milestones.length > 0) {
                        if (afterElement) {
                            const afterIndex = milestones.indexOf(afterElement);
                            if (afterIndex > 0) {
                                const prevAssignment = assignments.find(a => 
                                    a.id === parseInt(milestones[afterIndex - 1].dataset.assignmentId)
                                );
                                if (prevAssignment) {
                                    const prevDate = new Date(prevAssignment.dueDate);
                                    newDueDate = new Date(prevDate.getTime() + 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                                }
                            }
                        } else {
                            const lastMilestone = milestones[milestones.length - 1];
                            const lastAssignment = assignments.find(a => 
                                a.id === parseInt(lastMilestone.dataset.assignmentId)
                            );
                            if (lastAssignment) {
                                const lastDate = new Date(lastAssignment.dueDate);
                                newDueDate = new Date(lastDate.getTime() + 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                            }
                        }
                    }
                    
                    // Update assignment due date
                    assignment.dueDate = newDueDate;
                    saveAssignments(assignments);
                    
                    // Remove indicators
                    document.querySelectorAll('.drop-indicator').forEach(ind => ind.remove());
                    
                    // Regenerate roadmap
                    generateRoadmap();
                });
                
                path.addEventListener('dragleave', (e) => {
                    // Only remove indicator if we're actually leaving the path
                    if (!path.contains(e.relatedTarget)) {
                        document.querySelectorAll('.drop-indicator').forEach(ind => ind.remove());
                    }
                });
            });
            
            // Also allow dropping on the timeline container itself
            if (timeline) {
                timeline.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                });
            }
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.draggable-milestone:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function openStarMap() {
            const modal = document.getElementById('starMapModal');
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            generateRoadmap();
        }

        function closeStarMap() {
            const modal = document.getElementById('starMapModal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        function downloadRoadmap() {
            alert('Roadmap download feature coming soon! For now, you can take a screenshot of your roadmap.');
        }

        // Educational Videos Data
        const educationalVideos = [
            { id: 1, title: "Introduction to Algebra", subject: "Math", duration: "15:30", thumbnail: "üìê", description: "Learn the basics of algebraic expressions" },
            { id: 2, title: "Cell Biology Explained", subject: "Science", duration: "22:45", thumbnail: "üß¨", description: "Understanding cell structure and function" },
            { id: 3, title: "World War II Overview", subject: "History", duration: "28:20", thumbnail: "üåç", description: "Comprehensive guide to WWII events" },
            { id: 4, title: "Periodic Table Mastery", subject: "Chemistry", duration: "18:15", thumbnail: "‚öóÔ∏è", description: "Master the elements and their properties" },
            { id: 5, title: "Shakespeare's Sonnets", subject: "Literature", duration: "25:10", thumbnail: "üìö", description: "Analyze and appreciate classic poetry" },
            { id: 6, title: "Calculus Fundamentals", subject: "Math", duration: "35:00", thumbnail: "üî≠", description: "Introduction to derivatives and integrals" }
        ];

        function loadVideos() {
            const grid = document.getElementById('videosGrid');
            if (!grid) return;
            grid.innerHTML = educationalVideos.map(video => `
                <a href="video-player.html?id=${video.id}" class="glass-card p-6 hover:scale-105 transition-transform cursor-pointer block">
                    <div class="relative mb-4 bg-gradient-to-br from-[#0B0F2F] to-[#482880] rounded-lg p-8 text-center">
                        <div class="text-6xl mb-2">${video.thumbnail}</div>
                        <div class="absolute bottom-2 right-2 bg-black/70 px-2 py-1 rounded text-xs">${video.duration}</div>
                        <div class="absolute inset-0 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity">
                            <div class="bg-black/50 rounded-full p-4">
                                <span class="text-4xl">‚ñ∂</span>
                            </div>
                        </div>
                    </div>
                    <h3 class="text-lg font-bold mb-2">${video.title}</h3>
                    <p class="text-sm text-[#F5F7FA]/70 mb-3">${video.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-[#F5F7FA]/60">${video.subject}</span>
                        <span class="btn-primary text-sm py-1 px-4 inline-block">Watch Video</span>
                    </div>
                </a>
            `).join('');
        }

        // Downloadable Materials Data
        const downloadableMaterials = [
            { id: 1, title: "Algebra Study Guide", type: "PDF", size: "2.4 MB", subject: "Math", icon: "üìÑ", filename: "Algebra_Study_Guide.pdf" },
            { id: 2, title: "Business Fundamentals", type: "PDF", size: "1.8 MB", subject: "Business", icon: "üìã", filename: "Business_Fundamentals.pdf" },
            { id: 3, title: "History Timeline Chart", type: "PDF", size: "3.1 MB", subject: "History", icon: "üìä", filename: "History_Timeline_Chart.pdf" },
            { id: 4, title: "Chemistry Formula Sheet", type: "PDF", size: "1.2 MB", subject: "Chemistry", icon: "üß™", filename: "Chemistry_Formula_Sheet.pdf" },
            { id: 5, title: "Practice Quiz", type: "PDF", size: "0.9 MB", subject: "General", icon: "üìù", filename: "Practice_Quiz.pdf" },
            { id: 6, title: "Math Practice Problems", type: "PDF", size: "4.2 MB", subject: "Math", icon: "üìê", filename: "Math_Practice_Problems.pdf" },
            { id: 7, title: "Science Experiment Guide", type: "PDF", size: "2.7 MB", subject: "Science", icon: "üî¨", filename: "Science_Experiment_Guide.pdf" },
            { id: 8, title: "Vocabulary Flashcard Set", type: "PDF", size: "1.5 MB", subject: "Language", icon: "üìö", filename: "Vocabulary_Flashcard_Set.pdf" }
        ];

        function loadDownloads() {
            const grid = document.getElementById('downloadsGrid');
            if (!grid) return;
            grid.innerHTML = downloadableMaterials.map(material => `
                <div class="glass-card p-6 hover:scale-105 transition-transform">
                    <div class="text-5xl mb-4 text-center">${material.icon}</div>
                    <h3 class="text-lg font-bold mb-2">${material.title}</h3>
                    <div class="flex justify-between items-center mb-3 text-sm text-[#F5F7FA]/70">
                        <span>${material.type}</span>
                        <span>${material.size}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-[#F5F7FA]/60">${material.subject}</span>
                        <button onclick="generateAndDownloadPDF('${material.id}')" class="btn-secondary text-sm py-1 px-4">
                            Download
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function generateAndDownloadPDF(materialId) {
            const material = downloadableMaterials.find(m => m.id == materialId);
            if (!material) return;

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Generate PDF based on material type
            switch(material.id) {
                case 1: // Algebra Study Guide
                    generateAlgebraPDF(doc);
                    break;
                case 2: // Business Fundamentals
                    generateBusinessPDF(doc);
                    break;
                case 3: // History Timeline Chart
                    generateHistoryPDF(doc);
                    break;
                case 4: // Chemistry Formula Sheet
                    generateChemistryPDF(doc);
                    break;
                case 5: // Practice Quiz
                    generateQuizPDF(doc);
                    break;
                case 6: // Math Practice Problems
                    generateMathProblemsPDF(doc);
                    break;
                case 7: // Science Experiment Guide
                    generateSciencePDF(doc);
                    break;
                case 8: // Vocabulary Flashcard Set
                    generateVocabularyPDF(doc);
                    break;
            }

            doc.save(material.filename);
        }

        function generateAlgebraPDF(doc) {
            doc.setFontSize(20);
            doc.setTextColor(79, 195, 247);
            doc.text('Algebra Study Guide', 105, 20, { align: 'center' });
            
            let y = 35;
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text('This study guide covers fundamental algebra concepts, formulas, and practice problems.', 20, y);
            y += 15;
            
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Basic Formulas', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            const formulas = [
                'Linear Equation: y = mx + b',
                'Slope Formula: m = (y‚ÇÇ - y‚ÇÅ) / (x‚ÇÇ - x‚ÇÅ)',
                'Quadratic Formula: x = (-b ¬± ‚àö(b¬≤ - 4ac)) / 2a',
                'Distance Formula: d = ‚àö((x‚ÇÇ - x‚ÇÅ)¬≤ + (y‚ÇÇ - y‚ÇÅ)¬≤)',
                'Midpoint Formula: M = ((x‚ÇÅ + x‚ÇÇ)/2, (y‚ÇÅ + y‚ÇÇ)/2)'
            ];
            
            formulas.forEach(formula => {
                doc.text('‚Ä¢ ' + formula, 25, y);
                y += 7;
            });
            
            y += 5;
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Worked Examples', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            doc.text('Example 1: Solve for x in 2x + 5 = 13', 25, y);
            y += 7;
            doc.text('Solution: 2x = 13 - 5 = 8, therefore x = 4', 30, y);
            y += 10;
            
            doc.text('Example 2: Factor x¬≤ + 5x + 6', 25, y);
            y += 7;
            doc.text('Solution: (x + 2)(x + 3) = x¬≤ + 5x + 6', 30, y);
            y += 10;
            
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Practice Problems', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            const problems = [
                '1. Solve: 3x - 7 = 14',
                '2. Simplify: 2x + 3x - 5x',
                '3. Solve: x¬≤ - 9 = 0',
                '4. Find the slope: (2, 3) and (5, 9)',
                '5. Solve the system: x + y = 5, 2x - y = 1'
            ];
            
            problems.forEach(problem => {
                doc.text(problem, 25, y);
                y += 7;
            });
            
            y += 5;
            doc.text('Answer Key: 1) x = 7, 2) 0, 3) x = 3 or -3, 4) m = 2, 5) x = 2, y = 3', 25, y);
            
            doc.setFontSize(10);
            doc.setTextColor(128, 128, 128);
            doc.text('AstroLearn - Algebra Study Guide', 105, 280, { align: 'center' });
        }

        function generateBusinessPDF(doc) {
            doc.setFontSize(20);
            doc.setTextColor(79, 195, 247);
            doc.text('Business Fundamentals', 105, 20, { align: 'center' });
            
            let y = 35;
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Key Business Terms', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            const terms = [
                'Revenue: Total income from sales',
                'Profit: Revenue minus expenses',
                'Market: Group of potential customers',
                'Marketing: Promoting products or services',
                'Supply Chain: Process from production to consumer',
                'ROI: Return on Investment'
            ];
            
            terms.forEach(term => {
                doc.text('‚Ä¢ ' + term, 25, y);
                y += 7;
            });
            
            y += 5;
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Real-World Examples', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            doc.text('Example 1: A company sells 100 products at $10 each.', 25, y);
            y += 7;
            doc.text('Revenue = 100 √ó $10 = $1,000', 30, y);
            y += 10;
            
            doc.text('Example 2: If expenses are $700, profit = $1,000 - $700 = $300', 25, y);
            y += 10;
            
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Important Concepts', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            doc.text('‚Ä¢ Supply and Demand: Prices adjust based on availability', 25, y);
            y += 7;
            doc.text('‚Ä¢ Competition: Multiple businesses offering similar products', 25, y);
            y += 7;
            doc.text('‚Ä¢ Customer Service: Supporting customers before and after purchase', 25, y);
            
            doc.setFontSize(10);
            doc.setTextColor(128, 128, 128);
            doc.text('AstroLearn - Business Fundamentals', 105, 280, { align: 'center' });
        }

        function generateHistoryPDF(doc) {
            doc.setFontSize(20);
            doc.setTextColor(79, 195, 247);
            doc.text('History Timeline Chart', 105, 20, { align: 'center' });
            
            let y = 35;
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            
            const events = [
                { year: '1776', event: 'American Declaration of Independence' },
                { year: '1789', event: 'French Revolution begins' },
                { year: '1861-1865', event: 'American Civil War' },
                { year: '1914-1918', event: 'World War I' },
                { year: '1929', event: 'Great Depression begins' },
                { year: '1939-1945', event: 'World War II' },
                { year: '1969', event: 'Moon Landing' },
                { year: '1989', event: 'Fall of Berlin Wall' }
            ];
            
            events.forEach(item => {
                doc.setFontSize(14);
                doc.setTextColor(79, 195, 247);
                doc.text(item.year, 20, y);
                doc.setFontSize(11);
                doc.setTextColor(0, 0, 0);
                doc.text(item.event, 50, y);
                y += 10;
            });
            
            y += 10;
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Key Historical Concepts', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            const concepts = [
                '‚Ä¢ Causes and effects of major wars',
                '‚Ä¢ Impact of revolutions on society',
                '‚Ä¢ Economic factors in historical events',
                '‚Ä¢ Social and cultural changes over time'
            ];
            
            concepts.forEach(concept => {
                doc.text(concept, 25, y);
                y += 7;
            });
            
            doc.setFontSize(10);
            doc.setTextColor(128, 128, 128);
            doc.text('AstroLearn - History Timeline Chart', 105, 280, { align: 'center' });
        }

        function generateChemistryPDF(doc) {
            doc.setFontSize(20);
            doc.setTextColor(79, 195, 247);
            doc.text('Chemistry Formula Sheet', 105, 20, { align: 'center' });
            
            let y = 35;
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Basic Chemical Formulas', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            const formulas = [
                'Density: œÅ = m/V (mass/volume)',
                'Molarity: M = n/V (moles/liter)',
                'Percent Composition: % = (mass element / mass compound) √ó 100',
                'Ideal Gas Law: PV = nRT',
                'pH: pH = -log[H‚Å∫]',
                'Energy: E = hŒΩ (Planck constant √ó frequency)'
            ];
            
            formulas.forEach(formula => {
                doc.text('‚Ä¢ ' + formula, 25, y);
                y += 7;
            });
            
            y += 5;
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Common Elements', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            const elements = [
                'H - Hydrogen (Atomic #1)',
                'C - Carbon (Atomic #6)',
                'N - Nitrogen (Atomic #7)',
                'O - Oxygen (Atomic #8)',
                'Na - Sodium (Atomic #11)',
                'Cl - Chlorine (Atomic #17)'
            ];
            
            elements.forEach(element => {
                doc.text('‚Ä¢ ' + element, 25, y);
                y += 7;
            });
            
            y += 5;
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Common Compounds', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            doc.text('‚Ä¢ H‚ÇÇO - Water', 25, y);
            y += 7;
            doc.text('‚Ä¢ CO‚ÇÇ - Carbon Dioxide', 25, y);
            y += 7;
            doc.text('‚Ä¢ NaCl - Sodium Chloride (Salt)', 25, y);
            y += 7;
            doc.text('‚Ä¢ C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ - Glucose', 25, y);
            
            doc.setFontSize(10);
            doc.setTextColor(128, 128, 128);
            doc.text('AstroLearn - Chemistry Formula Sheet', 105, 280, { align: 'center' });
        }

        function generateQuizPDF(doc) {
            doc.setFontSize(20);
            doc.setTextColor(79, 195, 247);
            doc.text('Practice Quiz', 105, 20, { align: 'center' });
            
            let y = 35;
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text('Multiple Choice Questions - Answer all questions', 20, y);
            y += 15;
            
            const questions = [
                { q: '1. What is the solution to 2x + 5 = 13?', options: ['A) x = 3', 'B) x = 4', 'C) x = 5', 'D) x = 6'], answer: 'B' },
                { q: '2. What is the capital of France?', options: ['A) London', 'B) Berlin', 'C) Paris', 'D) Madrid'], answer: 'C' },
                { q: '3. What is H‚ÇÇO?', options: ['A) Carbon Dioxide', 'B) Water', 'C) Oxygen', 'D) Hydrogen'], answer: 'B' },
                { q: '4. Who wrote "Romeo and Juliet"?', options: ['A) Charles Dickens', 'B) William Shakespeare', 'C) Mark Twain', 'D) Jane Austen'], answer: 'B' },
                { q: '5. What is the square root of 64?', options: ['A) 6', 'B) 7', 'C) 8', 'D) 9'], answer: 'C' }
            ];
            
            questions.forEach(item => {
                doc.setFontSize(11);
                doc.setTextColor(0, 0, 0);
                doc.text(item.q, 20, y);
                y += 7;
                item.options.forEach(opt => {
                    doc.text(opt, 25, y);
                    y += 6;
                });
                y += 5;
            });
            
            y += 5;
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Answer Key', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            questions.forEach((item, index) => {
                doc.text(`${index + 1}. ${item.answer}`, 25, y);
                y += 7;
            });
            
            doc.setFontSize(10);
            doc.setTextColor(128, 128, 128);
            doc.text('AstroLearn - Practice Quiz', 105, 280, { align: 'center' });
        }

        function generateMathProblemsPDF(doc) {
            doc.setFontSize(20);
            doc.setTextColor(79, 195, 247);
            doc.text('Math Practice Problems', 105, 20, { align: 'center' });
            
            let y = 35;
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Algebra Problems', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            const algProblems = [
                '1. Solve for x: 5x + 3 = 23',
                '2. Simplify: (2x + 3)(x - 4)',
                '3. Solve: x¬≤ - 5x + 6 = 0',
                '4. Find x: 3x/2 = 9',
                '5. Solve: 2x + 3y = 12, x - y = 1'
            ];
            
            algProblems.forEach(prob => {
                doc.text(prob, 25, y);
                y += 7;
            });
            
            y += 10;
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Geometry Problems', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            const geoProblems = [
                '6. Find the area of a rectangle: length = 8, width = 5',
                '7. Calculate the perimeter of a square with side = 6',
                '8. Find the area of a circle with radius = 4 (use œÄ = 3.14)',
                '9. Calculate the volume of a cube with side = 3',
                '10. Find the area of a triangle: base = 10, height = 6'
            ];
            
            geoProblems.forEach(prob => {
                doc.text(prob, 25, y);
                y += 7;
            });
            
            y += 10;
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Answer Key', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            doc.text('1) x = 4, 2) 2x¬≤ - 5x - 12, 3) x = 2 or 3, 4) x = 6, 5) x = 3, y = 2', 25, y);
            y += 7;
            doc.text('6) 40, 7) 24, 8) 50.24, 9) 27, 10) 30', 25, y);
            
            doc.setFontSize(10);
            doc.setTextColor(128, 128, 128);
            doc.text('AstroLearn - Math Practice Problems', 105, 280, { align: 'center' });
        }

        function generateSciencePDF(doc) {
            doc.setFontSize(20);
            doc.setTextColor(79, 195, 247);
            doc.text('Science Experiment Guide', 105, 20, { align: 'center' });
            
            let y = 35;
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text('This guide provides step-by-step instructions for common science experiments.', 20, y);
            y += 15;
            
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Experiment 1: Photosynthesis in Plants', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            doc.text('Materials:', 25, y);
            y += 7;
            doc.text('‚Ä¢ Plant leaves, iodine solution, beaker, water', 30, y);
            y += 10;
            
            doc.text('Procedure:', 25, y);
            y += 7;
            doc.text('1. Place leaf in boiling water for 2 minutes', 30, y);
            y += 7;
            doc.text('2. Remove and place in alcohol to remove chlorophyll', 30, y);
            y += 7;
            doc.text('3. Add iodine solution and observe color change', 30, y);
            y += 10;
            
            doc.text('Observation: Blue-black color indicates presence of starch', 25, y);
            y += 15;
            
            doc.setFontSize(16);
            doc.setTextColor(79, 195, 247);
            doc.text('Experiment 2: Density of Liquids', 20, y);
            y += 10;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            doc.text('Materials: Water, oil, graduated cylinder, scale', 25, y);
            y += 10;
            
            doc.text('Procedure:', 25, y);
            y += 7;
            doc.text('1. Measure 50ml of water and record mass', 30, y);
            y += 7;
            doc.text('2. Calculate density: œÅ = mass/volume', 30, y);
            y += 7;
            doc.text('3. Repeat with oil and compare results', 30, y);
            
            doc.setFontSize(10);
            doc.setTextColor(128, 128, 128);
            doc.text('AstroLearn - Science Experiment Guide', 105, 280, { align: 'center' });
        }

        function generateVocabularyPDF(doc) {
            doc.setFontSize(20);
            doc.setTextColor(79, 195, 247);
            doc.text('Vocabulary Flashcard Set', 105, 20, { align: 'center' });
            
            let y = 35;
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            
            const vocab = [
                { word: 'Analyze', def: 'To examine in detail' },
                { word: 'Synthesize', def: 'To combine parts into a whole' },
                { word: 'Evaluate', def: 'To judge or assess' },
                { word: 'Hypothesis', def: 'A proposed explanation' },
                { word: 'Variable', def: 'A factor that can change' },
                { word: 'Constant', def: 'A value that does not change' },
                { word: 'Evidence', def: 'Information supporting a claim' },
                { word: 'Conclusion', def: 'Final decision or judgment' }
            ];
            
            vocab.forEach(item => {
                doc.setFontSize(13);
                doc.setTextColor(79, 195, 247);
                doc.text(item.word, 20, y);
                doc.setFontSize(11);
                doc.setTextColor(0, 0, 0);
                doc.text('‚Üí ' + item.def, 60, y);
                y += 10;
            });
            
            doc.setFontSize(10);
            doc.setTextColor(128, 128, 128);
            doc.text('AstroLearn - Vocabulary Flashcard Set', 105, 280, { align: 'center' });
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (isLoggedIn()) {
                loadLessons();
                loadVideos();
                loadDownloads();
                initFloatingStars();
                
                // Star Map button functionality
                const starMapBtn = document.getElementById('starMapBtn');
                const closeBtn = document.getElementById('closeStarMap');
                const closeBtn2 = document.getElementById('closeStarMapBtn');
                const overlay = document.getElementById('starMapOverlay');
                
                if (starMapBtn) {
                    starMapBtn.addEventListener('click', openStarMap);
                }
                if (closeBtn) {
                    closeBtn.addEventListener('click', closeStarMap);
                }
                if (closeBtn2) {
                    closeBtn2.addEventListener('click', closeStarMap);
                }
                if (overlay) {
                    overlay.addEventListener('click', closeStarMap);
                }
                
                // Check for lesson parameter in URL
                const urlParams = new URLSearchParams(window.location.search);
                const lessonId = urlParams.get('lesson');
                const subject = urlParams.get('subject');
                
                if (lessonId && subject) {
                    // Wait a bit for lessons to load, then open the lesson
                    setTimeout(() => {
                        openLesson(lessonId, subject);
                        // Clean up URL
                        const newUrl = window.location.pathname;
                        window.history.replaceState({}, document.title, newUrl);
                    }, 500);
                }
            }
        });
    </script>
</body>
</html>
